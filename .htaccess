#
# BARAQA AI Affiliate Hub .htaccess
# Handles URL rewriting, security, and performance settings.
#

# --- 1. Enable Core Rewrite Engine ---
RewriteEngine On
RewriteBase /bs/

# --- 2. Security Enhancements ---
# Prevent directory browsing
Options -Indexes

# Block access to sensitive files
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|inc|sql|env|bak|py|md|json|lock)$">
    Require all denied
</FilesMatch>

# Block direct access to specific important directories
RewriteRule ^(includes|jobs|config\.php) - [F,L,NC]


# --- 3. Canonical URL Redirection (Choose ONE block) ---
# Enforce HTTPS and non-www (e.g., https://yoursite.com)
# Uncomment the following lines when you have an SSL certificate
# RewriteCond %{HTTPS} off [OR]
# RewriteCond %{HTTP_HOST} ^www\. [NC]
# RewriteCond %{HTTP_HOST} ^(?:www\.)?(.+)$ [NC]
# RewriteRule ^ https://%1%{REQUEST_URI} [L,R=301,NE]

# Enforce HTTPS and www (e.g., https://www.yoursite.com)
# Uncomment the following lines when you have an SSL certificate
# RewriteCond %{HTTPS} off [OR]
# RewriteCond %{HTTP_HOST} !^www\. [NC]
# RewriteRule ^ https://www.yoursite.com%{REQUEST_URI} [L,R=301,NE]


# --- 4. SEO-Friendly URL Rewriting ---
# First, remove trailing slashes from URLs
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)/$ /$1 [L,R=301]

# Rule for product pages: /product/some-product-slug
RewriteRule ^product/([^/]+)/?$ product.php?slug=$1 [L,QSA]

# Rule for category pages: /category/some-category-slug
RewriteRule ^category/([^/]+)/?$ category.php?slug=$1 [L,QSA]

# Rule for brand pages: /brand/some-brand-slug
RewriteRule ^brand/([^/]+)/?$ brand.php?slug=$1 [L,QSA]

# Rule for static pages: /page/about-us
RewriteRule ^page/([^/]+)/?$ page.php?slug=$1 [L,QSA]

# Rule for search page: /search?q=keyword
RewriteRule ^search/?$ search.php [L,QSA]


# --- 5. Hide .php extension ---
# This rule allows access to files like /bs/wishlist instead of /bs/wishlist.php
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^([^\.]+)$ $1.php [L]


# --- 6. Browser Caching (Performance) ---
# Uncomment this section for a production server to improve performance
# <IfModule mod_expires.c>
#   ExpiresActive On
#   ExpiresByType image/jpg "access 1 year"
#   ExpiresByType image/jpeg "access 1 year"
#   ExpiresByType image/gif "access 1 year"
#   ExpiresByType image/png "access 1 year"
#   ExpiresByType image/svg+xml "access 1 year"
#   ExpiresByType text/css "access 1 month"
#   ExpiresByType application/javascript "access 1 month"
#   ExpiresByType application/x-javascript "access 1 month"
#   ExpiresByType image/x-icon "access 1 year"
#   ExpiresDefault "access 2 days"
# </IfModule>