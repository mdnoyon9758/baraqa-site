<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    # Set error and access log locations
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    <Directory /var/www/html>
        # --- 1. Enable Core Rewrite Engine ---
        RewriteEngine On

        # --- 2. Security Enhancements ---
        # Prevent directory browsing
        Options -Indexes +FollowSymLinks

        # Block access to sensitive files
        <FilesMatch "\.(htaccess|htpasswd|ini|log|sh|inc|sql|env|bak|py|md|json|lock)$">
            Require all denied
        </FilesMatch>

        # Block direct access to specific important directories
        # Note: Paths here are absolute from the server root
        RewriteRule ^/(includes|jobs|config\.php) - [F,L,NC]
    </Directory>
    
    # --- 3. Canonical URL (HTTPS) ---
    # Render handles HTTPS termination, so we don't need to force it here.
    # The server runs on HTTP internally, and Render's load balancer handles SSL.

    # --- 4. SEO-Friendly URL Rewriting ---
    # These rules are now at the server config level, so paths start with '/'

    # Rule to remove trailing slashes
    RewriteRule ^/(.*)/$ /$1 [L,R=301]

    # Rule for product pages: /product/some-product-slug
    RewriteRule ^/product/([^/]+)/?$ /product.php?slug=$1 [L,QSA]

    # Rule for category pages: /category/some-category-slug
    RewriteRule ^/category/([^/]+)/?$ /category.php?slug=$1 [L,QSA]

    # Rule for brand pages: /brand/some-brand-slug
    RewriteRule ^/brand/([^/]+)/?$ /brand.php?slug=$1 [L,QSA]

    # Rule for static pages: /page/about-us
    RewriteRule ^/page/([^/]+)/?$ /page.php?slug=$1 [L,QSA]

    # Rule for search page: /search?q=keyword
    RewriteRule ^/search/?$ /search.php [L,QSA]


    # --- 5. Hide .php extension ---
    # This block allows access to URLs like /wishlist instead of /wishlist.php
    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d
    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME}\.php -f
    RewriteRule ^/([^/]+)$ /$1.php [L]


    # Fallback to index.php if no file or rule matches
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^/.+ /index.php [L]

</VirtualHost>